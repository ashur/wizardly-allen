---
title: Log In
externalScripts:
  - https://identity.netlify.com/v1/netlify-identity-widget.js
  - https://unpkg.com/alpinejs
---
<button
	x-show="!currentUser"
	@click="login"
	style="display: none;"
>Log In</button>

<script>
	let app = {

		/* Properties */
		get apiOptions() {
			let options = {
				headers: {}
			};

			if( this.currentUser && this.currentUser.token )
			{
				options.headers["Authorization"] = `Bearer ${this.currentUser.token.access_token}`
			}

			return options;
		},

		currentUser: null,

		/* Methods */
		init() {
			this.currentUser = netlifyIdentity.currentUser();

			netlifyIdentity.on( "login", user =>
			{
				this.currentUser = user;
			});
		},

		login() {
			netlifyIdentity.open()
		},

		logout() {
			this.currentUser = null;
			netlifyIdentity.logout();
		},
	};

	let appPosts = {

		/* Properties */
		posts: [],

		/* Methods */
		getPosts() {
			fetch( "/api/v{{ apiVersion }}/posts", this.apiOptions )
				.then( response => response.json() )
				.then( data => this.posts = data.posts )
				.catch( error => console.log( "ohno", error ) )
		},
	};
</script>
